# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/linux-firmware/used-only.diff
# Copyright (C) 2022 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License version 2 as used by the T2 SDE.
# --- T2-COPYRIGHT-NOTE-END ---

--- linux-firmware-f219d61/copy-firmware.sh.vanilla	2022-04-13 14:00:38.600805435 +0200
+++ linux-firmware-f219d61/copy-firmware.sh	2022-04-13 14:06:05.000792420 +0200
@@ -32,6 +32,8 @@
 done
 
 grep '^File:' WHENCE | sed -e's/^File: *//g' -e's/"//g' | while read f; do
+    if ! grep -q "^$f$" INSTALLED; then rm -vf "$destdir/$f"
+	rmdir --ignore-fail-on-non-empty -p "$destdir/${f%/*}"; continue; fi
     test -f "$f" || continue
     $verbose "copying file $f"
     mkdir -p $destdir/$(dirname "$f")
@@ -39,6 +40,8 @@
 done
 
 grep -E '^Link:' WHENCE | sed -e's/^Link: *//g' -e's/-> //g' | while read f d; do
+    if ! grep -q "^$f$" INSTALLED; then rm -vf "$destdir/$f"
+	rmdir --ignore-fail-on-non-empty -p "$destdir/${f%/*}"; continue; fi
     if test -L "$f"; then
         test -f "$destdir/$f" && continue
         $verbose "copying link $f"
