# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/skia/skia.conf
# Copyright (C) 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

makeinstopt=
runcargo=0
rungo=0
runmake=0

create_skia_pc_file() {
    cat << EOT > $root$libdir/pkgconfig/skia.pc
prefix=/$prefix
exec_prefix=\${prefix}
libdir=\${prefix}/${libdir##*/}
includedir=\${prefix}/include/skia

Name: skia
Description: Skia Graphics Library
Version: $desc_V
Libs: -L\${libdir} -lskia
Cflags: -I\${includedir}
EOT
}

skia_prepare(){
	python tools/git-sync-deps
	gn gen out/Shared --args='is_debug=false is_component_build=true skia_use_system_libs=true skia_use_system_libwebp=true skia_use_system_libgifcodec=true skia_use_system_libxml=true skia_use_system_mesa=true'
}
hook_add premake 3 skia_prepare

hook_add inmake 5 "ninja -C out/Shared"

hook_add postmake 6 "cp out/Shared/libskia.so $libdir; mkdir -p /usr/include/skia; cp -r include/* $includedir/skia/"
hook_add postmake 7 create_skia_pc_file
