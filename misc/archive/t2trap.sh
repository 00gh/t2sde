#!/bin/bash
# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/t2trap.sh
# Copyright (C) 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

section=0

# *, base/*,  base/* but not */x11
pkgsel=minimal

#minimal-container # -> not base/{firmware,kernel,boot}

extract() {
	echo "$pkg ($ver)"
	return
	tar xf /media/24.10-generic-x86-64-nocona-cross-linux/pkgs/$pkg-$ver.tar.*
}

while read line; do
	if [ "${line}" = $'\004' ]; then
		section=0
		[ $selected = 1 ] && extract
	elif [ "${line}" = $'\027' ]; then
		((++section))
	else
		# each 1st new section line pkg name
		if [ $section = 0 ]; then
			pkg=$line
			selected=0
			#echo $pkg
		else
			if [[ $section = 1 && "$line" = "[V]"* ]]; then
				ver=${line#\[V\] }
			elif [[ $section = 1 && "$line" = "[C]"* ]]; then
				cat=${line#\[C\] }
				# TODO: iterate multiple
				echo "$pkg> $cat"

				selected=1
				[[ $pkgsel = minimal* && "$cat" != base/* ]] && selected=0
				[[ $pkgsel = minimal && "$cat" = base/x11 ]] && selected=0
			fi
		fi
	fi
done < <(gunzip < /media/24.10-generic-x86-64-nocona-cross-linux/pkgs/packages.db)
