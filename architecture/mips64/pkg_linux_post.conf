# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: architecture/mips64/pkg_linux_post.conf
# Copyright (C) 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

# build multiple sgi ip* kernels, sigh
build_sgi_variants() {
    var_remove_regex GCC_WRAPPER_REMOVE ' ' '-march=.*'
    var_remove_regex GCC_WRAPPER_INSERT ' ' '-march=.*'

    for var in ip27 ip30 ip32 ip32-r10k; do
	echo_status "Build $var variant"

	# Sgi O2 r10k++ -mmr10k-cache-barrier=load-store appears to break w/ -Os
	[[ $var = *r10k ]] && GCC_WRAPPER_INSERT="${GCC_WRAPPER_INSERT/-Os/-O1}"

	auto_config $var

	lx_extraversion=${lx_extraversion%-*}-$var
	lx_injectextraversion

	eval $MAKE $makeopt
	eval $MAKE $makeinstopt # modules
	linux_install
    done
}
hook_add postmake 5 build_sgi_variants
